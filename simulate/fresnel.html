<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>菲涅尔衍射模拟</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .controls {
            margin-bottom: 20px;
        }
        .controls label {
            display: inline-block;
            width: 150px;
        }
        canvas {
            border: 1px solid #000;
        }
    </style>
</head>
<body>
    <h1>菲涅尔衍射模拟</h1>
    <div class="controls">
        <div>
            <label for="wavelength">波长 (λ, nm):</label>
            <input type="number" id="wavelength" value="500" min="100" max="1000"> 
        </div>
        <div>
            <label for="gratingSpacing">光栅间距 (d, μm):</label>
            <input type="number" id="gratingSpacing" value="10" min="1" max="100"> 
        </div>
        <div>
            <label for="gratingCount">光栅数量 (N):</label>
            <input type="number" id="gratingCount" value="5" min="1" max="20"> 
        </div>
        <div>
            <label for="slitWidth">光栅宽度 (a, μm):</label>
            <input type="number" id="slitWidth" value="5" min="0.1" max="100" step="0.1"> 
        </div>
        <div>
            <label for="distance">观察距离 (z, cm):</label>
            <input type="number" id="distance" value="100" min="10" max="1000"> 
        </div>
        <div>
            <button id="simulateBtn">模拟</button>
        </div>
    </div>
    <canvas id="diffractionCanvas" width="800" height="600"></canvas>

    <script>
        // 获取页面元素
        const wavelengthInput = document.getElementById('wavelength');
        const gratingSpacingInput = document.getElementById('gratingSpacing');
        const gratingCountInput = document.getElementById('gratingCount');
        const slitWidthInput = document.getElementById('slitWidth');
        const distanceInput = document.getElementById('distance');
        const simulateBtn = document.getElementById('simulateBtn');
        const canvas = document.getElementById('diffractionCanvas');
        const ctx = canvas.getContext('2d');

        // 物理常数
        const pi = Math.PI;

        // 模拟函数
        function simulateFresnelDiffraction() {
            // 获取参数
            const lambda = parseFloat(wavelengthInput.value) * 1e-9; // 转换为米
            const d = parseFloat(gratingSpacingInput.value) * 1e-6; // 米
            const N = parseInt(gratingCountInput.value);
            const a = parseFloat(slitWidthInput.value) * 1e-6; // 米
            const z = parseFloat(distanceInput.value) * 1e-2; // 米

            // 画布参数
            const width = canvas.width;
            const height = canvas.height;
            const centerX = width / 2;
            const centerY = height / 2;
            const maxIntensity = [];

            // 定义观察屏范围（-5 mm 到 5 mm）
            const screenSize = 5e-3; // 米
            const dx = 2 * screenSize / width;

            // 预计算光栅位置
            const slitPositions = [];
            const totalWidth = (N - 1) * d;
            const startX = -totalWidth / 2;
            for (let i = 0; i < N; i++) {
                slitPositions.push(startX + i * d);
            }

            // 计算光强
            const intensity = new Float32Array(width);
            for (let i = 0; i < width; i++) {
                const x = -screenSize + i * dx; // 位置
                let E = 0; // 复振幅
                for (let pos of slitPositions) {
                    const r = Math.sqrt((pos)**2 + z**2);
                    const phase = (2 * pi / lambda) * r;
                    E += Math.exp(1j * phase) * (a / pos) ; // 简化振幅
                }
                intensity[i] = Math.abs(E)**2;
            }

            // 归一化
            const maxVal = Math.max(...intensity);
            for (let i = 0; i < width; i++) {
                intensity[i] = intensity[i] / maxVal;
            }

            // 绘制
            const imageData = ctx.createImageData(width, height);
            for (let i = 0; i < width; i++) {
                const bright = Math.floor(intensity[i] * 255);
                for (let j = 0; j < height; j++) {
                    const index = (j * width + i) * 4;
                    imageData.data[index] = bright;     // R
                    imageData.data[index + 1] = bright; // G
                    imageData.data[index + 2] = bright; // B
                    imageData.data[index + 3] = 255;    // A
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }

        // 添加事件监听
        simulateBtn.addEventListener('click', simulateFresnelDiffraction);

        // 初始模拟
        simulateFresnelDiffraction();
    </script>
</body>
</html>
