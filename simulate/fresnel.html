<!DOCTYPE html>
<html>
<head>
    <title>菲涅尔衍射模拟</title>
    <style>
        .container {
            display: flex;
            flex-direction: row;
            padding: 20px;
        }
        .controls {
            width: 300px;
            padding: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="controls">
            <h2>参数控制</h2>
            <div class="control-group">
                <label for="wavelength">波长 (nm):</label>
                <input type="range" id="wavelength" min="380" max="780" value="550" step="1">
                <span id="wavelengthValue">550</span>
            </div>
            <div class="control-group">
                <label for="slitSpacing">光栅间距 (μm):</label>
                <input type="range" id="slitSpacing" min="1" max="50" value="10" step="0.1">
                <span id="slitSpacingValue">10</span>
            </div>
            <div class="control-group">
                <label for="slitWidth">光栅宽度 (μm):</label>
                <input type="range" id="slitWidth" min="0.1" max="10" value="2" step="0.1">
                <span id="slitWidthValue">2</span>
            </div>
            <div class="control-group">
                <label for="slitCount">光栅数量:</label>
                <input type="range" id="slitCount" min="1" max="10" value="2" step="1">
                <span id="slitCountValue">2</span>
            </div>
        </div>
        <canvas id="diffractionCanvas" width="800" height="400"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('diffractionCanvas');
        const ctx = canvas.getContext('2d');
        
        // 获取所有输入控件
        const controls = {
            wavelength: document.getElementById('wavelength'),
            slitSpacing: document.getElementById('slitSpacing'),
            slitWidth: document.getElementById('slitWidth'),
            slitCount: document.getElementById('slitCount')
        };

        // 更新显示值
        function updateValue(id, value) {
            document.getElementById(id + 'Value').textContent = value;
        }

        // 计算衍射强度
        function calculateIntensity(theta, params) {
            const { wavelength, slitWidth, slitSpacing, slitCount } = params;
            
            // 单缝衍射因子
            const alpha = Math.PI * slitWidth * Math.sin(theta) / wavelength;
            const beta = Math.PI * slitSpacing * Math.sin(theta) / wavelength;
            
            let singleSlitFactor = 1;
            if (alpha !== 0) {
                singleSlitFactor = Math.pow(Math.sin(alpha) / alpha, 2);
            }
            
            // 多缝干涉因子
            let multiSlitFactor = 1;
            if (slitCount > 1) {
                const numerator = Math.sin(slitCount * beta);
                const denominator = Math.sin(beta);
                multiSlitFactor = Math.pow(numerator / (slitCount * denominator), 2);
            }
            
            return singleSlitFactor * multiSlitFactor;
        }

        // 绘制衍射图样
        function drawDiffractionPattern() {
            // 清除画布
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // 获取当前参数
            const params = {
                wavelength: controls.wavelength.value * 1e-9, // 转换为米
                slitWidth: controls.slitWidth.value * 1e-6,  // 转换为米
                slitSpacing: controls.slitSpacing.value * 1e-6,
                slitCount: parseInt(controls.slitCount.value)
            };

            // 绘制参数
            const centerY = canvas.height / 2;
            const scale = 200; // 缩放因子

            // 绘制强度分布
            ctx.beginPath();
            ctx.moveTo(0, centerY);

            for (let x = 0; x < canvas.width; x++) {
                const theta = (x - canvas.width/2) / 1000;
                const intensity = calculateIntensity(theta, params);
                const y = centerY - intensity * scale;
                ctx.lineTo(x, y);
            }

            ctx.strokeStyle = 'blue';
            ctx.stroke();

            // 绘制中心线
            ctx.beginPath();
            ctx.moveTo(canvas.width/2, 0);
            ctx.lineTo(canvas.width/2, canvas.height);
            ctx.strokeStyle = '#ccc';
            ctx.stroke();
        }

        // 添加事件监听器
        Object.keys(controls).forEach(key => {
            controls[key].addEventListener('input', function() {
                updateValue(key, this.value);
                drawDiffractionPattern();
            });
        });

        // 初始绘制
        drawDiffractionPattern();
    </script>
</body>
</html>  
